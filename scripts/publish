#! /usr/bin/env bash

set -e
set -u
set -o pipefail

# preconditions and setup
test -d .git
test -d packnback.github.io
test -d ~/src/packnback.github.io
test -d ~/src/packnback.github.io/.git
(cd  ~/src/packnback.github.io/ && git reset --hard)
# we require this so the glob will not delete our whole dir
test -f ~/src/packnback.github.io/index.html
rm -rf ~/src/packnback.github.io/*

if test -d ./packnback.github.io/public
then
	rm -rf ./packnback.github.io/public
fi

# build steps

cd ./packnback.github.io
hugo -t packnback

cp -r public/* ~/src/packnback.github.io/
cd ~/src/packnback.github.io/
git add *
git commit -m "autogenerated code" -a