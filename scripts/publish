#! /usr/bin/env bash

set -x
set -e
set -u
set -o pipefail

# preconditions and setup
test -f ./scripts/build
test -d ~/src/packnback.github.io
test -d ~/src/packnback.github.io/.git
(cd  ~/src/packnback.github.io/ && git reset --hard)
# we require this so the glob will not delete our whole dir
test -f ~/src/packnback.github.io/index.html
rm -rf ~/src/packnback.github.io/*

export ENABLE_ANALYTICS=true
# build steps
./scripts/build

cd ./packnback.github.io
test -d ./public
cp -r ./public/* ~/src/packnback.github.io/

cd ~/src/packnback.github.io/
cat <<EOF > README.md
AUTOGENERATED CODE, see github.com/packnback/site
EOF


git add *
git commit -m "autogenerated code" -a
git push